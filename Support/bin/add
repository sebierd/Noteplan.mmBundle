#!/usr/bin/ruby -w
# encoding: UTF-8

require 'cgi'

# get environmentel variables
message_url = "(message://%3c" + ENV['MM_MESSAGE_ID'] + "%3e)"
subject = "[" + ENV['MM_SUBJECT'] + "]"
day = ENV['NP_DAY']

# x-callback-url scheme: https://noteplan.co/faq/General/X-Callback-Url%20Scheme/
# create a new task
url = "noteplan://x-callback-url/addText?noteDate=" + day + "&mode=append&openNote=yes&text=*%20" + CGI::escape(subject).gsub('+', '%20') + CGI::escape(message_url).gsub('+', '%20')
# Use AppleScript to communicate with the application
system("open", url)
